---
last_modified_on: "2020-04-11"
component_title: "Kubernetes Pod Metadata"
description: "The Vector `kubernetes_pod_metadata` transform accepts and outputs `log` events allowing you to enrich Kubernetes logs with Pod metadata."
event_types: ["log"]
function_category: "enrich"
issues_url: https://github.com/timberio/vector/issues?q=is%3Aopen+is%3Aissue+label%3A%22transform%3A+kubernetes_pod_metadata%22
sidebar_label: "kubernetes_pod_metadata|[\"log\"]"
source_url: https://github.com/timberio/vector/tree/master/src/transforms/kubernetes
status: "beta"
title: "Kubernetes Pod Metadata Transform"
---

import Alert from '@site/src/components/Alert';
import Fields from '@site/src/components/Fields';
import Field from '@site/src/components/Field';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

The Vector `kubernetes_pod_metadata` transform
accepts and outputs [`log`][docs.data-model.log] events allowing you to enrich
[Kubernetes][urls.kubernetes] logs with Pod metadata.

<!--
     THIS FILE IS AUTOGENERATED!

     To make changes please edit the template located at:

     website/docs/reference/transforms/kubernetes_pod_metadata.md.erb
-->

## Requirements

<Alert icon={false} type="danger" className="list--warnings">

* [Kubernetes][urls.kubernetes] version `>= 1.12` is required.
* [Kubernetes RBAC][urls.kubernetes_rbac] must be enabled. See the ["Kubernetes RBAC" section][docs.transforms.kubernetes_pod_metadata#kubernetes-rbac] for more info.
* Permissions are required. See the ["Permissions" section][docs.transforms.kubernetes_pod_metadata#permissions] for more info.

</Alert>

## Configuration

<Tabs
  block={true}
  defaultValue="common"
  values={[{"label":"Common","value":"common"},{"label":"Advanced","value":"advanced"}]}>
<TabItem value="common">

```toml title="vector.toml"
[transforms.my_transform_id]
  type = "kubernetes_pod_metadata" # required
  inputs = ["my-source-id"] # required
  fields = ["name", "namespace", "labels", "annotations", "node_name"] # optional, default
```

</TabItem>
<TabItem value="advanced">

```toml title="vector.toml"
[transforms.my_transform_id]
  type = "kubernetes_pod_metadata" # required
  inputs = ["my-source-id"] # required
  cache_ttl = 3600 # optional, default, seconds
  fields = ["name", "namespace", "labels", "annotations", "node_name"] # optional, default
  max_retry_timeout = 1 # optional, default
  node_name = "${VECTOR_NODE_NAME}" # optional, default
  pod_uid = "object_uid" # optional, default
```

</TabItem>
</Tabs>

<Fields filters={true}>
<Field
  common={false}
  defaultValue={3600}
  enumValues={null}
  examples={[3600]}
  groups={[]}
  name={"cache_ttl"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"int"}
  unit={"seconds"}
  warnings={[]}
  >

### cache_ttl

How many seconds will the metadata be available after its Pod has been deleted.




</Field>
<Field
  common={true}
  defaultValue={["name","namespace","labels","annotations","node_name"]}
  enumValues={null}
  examples={[["name","namespace","labels","annotations","node_name"]]}
  groups={[]}
  name={"fields"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"[string]"}
  unit={null}
  warnings={[]}
  >

### fields

A list of fields to include in each event. By default, these fields are placed
under the global [`kubernetes_key`
option][docs.reference.global-options#kubernetes_key]. See
[Nesting](#nesting-metadata-fields) for more info.

 See [Nesting Metadata Fields](#nesting-metadata-fields) for more info.


</Field>
<Field
  common={false}
  defaultValue={1}
  enumValues={null}
  examples={[1]}
  groups={[]}
  name={"max_retry_timeout"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"int"}
  unit={null}
  warnings={[]}
  >

### max_retry_timeout

In the case of Kubernetes API communication failures Vector will indefinitely
retry with an exponenetial backoff. This option defines that maximum backoff
allowed.

 See [Kubernetes API Communication Failures](#kubernetes-api-communication-failures) for more info.


</Field>
<Field
  common={false}
  defaultValue={"${VECTOR_NODE_NAME}"}
  enumValues={null}
  examples={["${VECTOR_NODE_NAME}","minikube"]}
  groups={[]}
  name={"node_name"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  warnings={[]}
  >

### node_name

The name of the node whose Pod's log should be enriched. This field defaults to
the `VECTOR_NODE_NAME` env var. If you're using the [provided daemon
set][urls.kubernetes_limit_resources] then this environment variable is set for
you. Setting this to a static value will take priority over `VECTOR_NODE_NAME`.




</Field>
<Field
  common={false}
  defaultValue={"object_uid"}
  enumValues={null}
  examples={["object_uid"]}
  groups={[]}
  name={"pod_uid"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  warnings={[]}
  >

### pod_uid

Field containg Pod UID to which log belongs.




</Field>
</Fields>

## Env Vars

<Fields filters={true}>
<Field
  common={true}
  defaultValue={null}
  enumValues={null}
  examples={["minikube"]}
  groups={[]}
  name={"VECTOR_NODE_NAME"}
  path={null}
  relevantWhen={null}
  required={true}
  templateable={false}
  type={"string"}
  unit={null}
  warnings={[]}
  >

### VECTOR_NODE_NAME

The name of the node whose Pod's log should be enriched. If you're using the
[provided daemon set][urls.kubernetes_limit_resources] then this environment
variable is set for you.




</Field>
</Fields>

## Permissions

The `kubernetes_pod_metadata` transform requires the following
permissions. If you are running a Kubernetes cluster you should have a basic
understanding of Kubernetes permissions. Refer to [Kubernetes Authorization
docs][urls.kubernetes_authorization] for more info.

<Fields>
<Field
  name={"watch"}
  required={true}
  >

### watch

Vector requires the [`watch` request verb][urls.kubernetes_request_verbs] in
order to retrieve Kubernetes metadata.



</Field>
</Fields>

## Fields

```javascript title="example log event"
{
  // ...
  "kubernetes": {
    "annotations": {
      "kubectl.kubernetes.io/last-applied-configuration": "..."
    },
    "creation_timestamp": "2019-11-01T21:15:47+00:00",
    "deletion_timestamp": "2019-11-01T21:15:47+00:00",
    "host_ip": "192.168.99.106",
    "hostname": "host",
    "ip": "172.17.0.5",
    "name": "nginx",
    "namespace": "default",
    "node_name": "minikube",
    "priority": 0,
    "priority_class_name": "system-node-critical",
    "service_account_name": "default",
    "subdomain": "net",
    "labels": {
      "release": "stable"
    }
  }
  // ...
}
```

<Fields filters={true}>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={[]}
  groups={[]}
  name={"annotations"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"table"}
  unit={null}
  warnings={[]}
  >

### annotations

[Annotations](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)
of the Pod where the log originated.



<Fields filters={false}>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={[{"kubectl.kubernetes.io/last-applied-configuration":"..."}]}
  groups={[]}
  name={"`[annotation-key]`"}
  path={"annotations"}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"*"}
  unit={null}
  warnings={[]}
  >

#### `[annotation-key]`

Each individual annotation will be added as a key. If you need to remove or
alter these labels then we recommend the [`remove_felds`
transform][docs.transforms.remove_fields].




</Field>
</Fields>

</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={["2019-11-01T21:15:47+00:00"]}
  groups={[]}
  name={"creation_timestamp"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"timestamp"}
  unit={null}
  warnings={[]}
  >

### creation_timestamp

Timestamp representing when the Pod was created.




</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={["2019-11-01T21:15:47+00:00"]}
  groups={[]}
  name={"deletion_timestamp"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"timestamp"}
  unit={null}
  warnings={[]}
  >

### deletion_timestamp

Timestamp representing when the Pod was deleted.




</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={["192.168.99.106"]}
  groups={[]}
  name={"host_ip"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  warnings={[]}
  >

### host_ip

The IP address of the host that the Pod is assigned where the log originated.




</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={["host"]}
  groups={[]}
  name={"hostname"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  warnings={[]}
  >

### hostname

The hostname of the Pod where the log originated.




</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={["172.17.0.5"]}
  groups={[]}
  name={"ip"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  warnings={[]}
  >

### ip

The IP address allocated to the Pod where the log originated.




</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={["nginx"]}
  groups={[]}
  name={"name"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  warnings={[]}
  >

### name

[Name][http://kubernetes.io/docs/user-guide/identifiers#names] of the Pod where
the log originated.




</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={["default","telemetry","kube-system"]}
  groups={[]}
  name={"namespace"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  warnings={[]}
  >

### namespace

[Namespace][http://kubernetes.io/docs/user-guide/namespaces] of the Pod where
the log originated.




</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={["minikube"]}
  groups={[]}
  name={"node_name"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  warnings={[]}
  >

### node_name

The name of the node where the log originated.




</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={[0]}
  groups={[]}
  name={"priority"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"int"}
  unit={null}
  warnings={[]}
  >

### priority

The
[priority](https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/)
of the Pod where the log originated.




</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={["system-node-critical","system-cluster-critical"]}
  groups={[]}
  name={"priority_class_name"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  warnings={[]}
  >

### priority_class_name

The [priority
class](https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/#priorityclass)
of the Pod where the log originated.




</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={["default"]}
  groups={[]}
  name={"service_account_name"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  warnings={[]}
  >

### service_account_name

The name of the
[ServiceAccount][https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/]
used to run the Pod where the log originated.




</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={["net"]}
  groups={[]}
  name={"subdomain"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"string"}
  unit={null}
  warnings={[]}
  >

### subdomain

The subdomain of the Pod where the log originated.




</Field>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={[]}
  groups={[]}
  name={"labels"}
  path={null}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"table"}
  unit={null}
  warnings={[]}
  >

### labels

[Labels](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)
of the Pod where the log originated.



<Fields filters={false}>
<Field
  common={false}
  defaultValue={null}
  enumValues={null}
  examples={[{"release":"stable"},{"tier":"frontend"}]}
  groups={[]}
  name={"`[label-key]`"}
  path={"labels"}
  relevantWhen={null}
  required={false}
  templateable={false}
  type={"*"}
  unit={null}
  warnings={[]}
  >

#### `[label-key]`

Each individual label will be added as a key. If you need to remove or alter
these labels then we recommend the [`remove_felds`
transform][docs.transforms.remove_fields].




</Field>
</Fields>

</Field>
</Fields>

## How It Works

### Building & Maintaining The Metadata

Vector leverages the [Rust `k8s-openapi` crate][urls.rust_k8s_openapi_crate]
to communicate with the [Kubernetes API][urls.kubernetes_api] to build and
maintaing the Pod metadata that this component enriches the log with.

This metadata is held in memory. The loading and maintenance of this data is
performed asynchronously, in the background, as to not block log processing.
Upon starting Vector the metadata is loaded and then Vector utilizes the
[Kubernetes Watch API][urls.kubernetes_watch_api] to stream Pod updates in
real-time, there is no polling involved.

### Complex Processing

If you encounter limitations with the `kubernetes_pod_metadata`
transform then we recommend using a [runtime transform][urls.vector_programmable_transforms].
These transforms are designed for complex processing and give you the power of
full programming runtime.

### Connecting To The Kubernetes API server

Vector will automatically attempt to connect to the [Kubernetes API
server][urls.kubernetes_api_server] for you. If Vector is running in a
Kubernetes cluster then Vector will connect to that cluster using the
[Kubernetes provided access information][urls.kubernetes_accessing_api_from_pod].

### Environment Variables

Environment variables are supported through all of Vector's configuration.
Simply add `${MY_ENV_VAR}` in your Vector configuration file and the variable
will be replaced before being evaluated.

You can learn more in the
[Environment Variables][docs.configuration#environment-variables] section.

### Kubernetes API Communication Failures

Vector will retry failed Kubernetes API requests indefinitely. Retries will
exponentially backoff with jitter and across uniform distribution whose upper
limit you can control via the [`max_retry_timeout`](#max_retry_timeout) option. This ensures that
Vector does not effectively DDOS your Kubernetes API in the event of failure.

### Kubernetes RBAC

Kubernetes [RBAC][urls.kubernetes_rbac] must be enabled for this component to
work. This can be achieved by passing the appropriate flags when starting
the [Kubernetes API server][urls.kubernetes_api_server]:

```bash
kube-apiserver --authorization-mode=RBAC ...
```

For specific permissions, please see the ["Permissions"
section][docs.transforms.kubernetes_pod_metadata#permissions].

### Log Data Collection

To collect Kubernetes logs please refer to the `kubernetes` source.

### Nesting Metadata Fields

Fields defined with [`fields`](#fields) option will be nested under the
[global `kubernetes_key`][docs.reference.global-options#kubernetes_key]. You
can change the name of this key or use the
[`rename_fields`][docs.transforms.rename_fields] transform to move it to the
root of the event.


[docs.configuration#environment-variables]: /docs/setup/configuration/#environment-variables
[docs.data-model.log]: /docs/about/data-model/log/
[docs.reference.global-options#kubernetes_key]: /docs/reference/global-options/#kubernetes_key
[docs.transforms.kubernetes_pod_metadata#kubernetes-rbac]: /docs/reference/transforms/kubernetes_pod_metadata/#kubernetes-rbac
[docs.transforms.kubernetes_pod_metadata#permissions]: /docs/reference/transforms/kubernetes_pod_metadata/#permissions
[docs.transforms.remove_fields]: /docs/reference/transforms/remove_fields/
[docs.transforms.rename_fields]: /docs/reference/transforms/rename_fields/
[urls.kubernetes]: https://kubernetes.io/
[urls.kubernetes_accessing_api_from_pod]: https://kubernetes.io/docs/tasks/access-application-cluster/access-cluster/#accessing-the-api-from-a-pod
[urls.kubernetes_api]: https://kubernetes.io/docs/concepts/overview/kubernetes-api/
[urls.kubernetes_api_server]: https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/
[urls.kubernetes_authorization]: https://kubernetes.io/docs/reference/access-authn-authz/authorization/
[urls.kubernetes_limit_resources]: https://kubernetes.io/docs/tasks/configure-pod-container/assign-cpu-resource/
[urls.kubernetes_rbac]: https://kubernetes.io/docs/reference/access-authn-authz/rbac/
[urls.kubernetes_request_verbs]: https://kubernetes.io/docs/reference/access-authn-authz/authorization/#determine-the-request-verb
[urls.kubernetes_watch_api]: https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.10/#watch-30
[urls.rust_k8s_openapi_crate]: https://docs.rs/k8s-openapi/
[urls.vector_programmable_transforms]: https://vector.dev/components/?functions%5B%5D=program
